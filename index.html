<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸŒ ××©×—×§ ××¡×˜×¨×˜×’×™×” ×¢×•×œ××™</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Assistant:wght@300;400;700&display=swap');
        
        body {
            font-family: 'Assistant', sans-serif;
            overflow: hidden;
        }

        .map-container {
            cursor: grab;
        }

        .map-container:active {
            cursor: grabbing;
        }

        .country-path {
            transition: all 0.3s ease;
        }

        .country-path:hover {
            opacity: 0.9;
            filter: brightness(1.2);
        }

        /* ×× ×™××¦×™×” ×œ×§×•×•×™ ××œ×—××” */
        @keyframes dash {
            to {
                stroke-dashoffset: 0;
            }
        }
        .war-line {
            stroke-dasharray: 10;
            stroke-dashoffset: 20;
            animation: dash 1s linear infinite;
        }
    </style>
</head>
<body class="w-full h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 text-white p-4">

    <div class="text-center mb-3">
        <h1 class="text-3xl font-bold bg-gradient-to-r from-yellow-400 to-orange-500 bg-clip-text text-transparent">
            ğŸŒ ××©×—×§ ××¡×˜×¨×˜×’×™×” ×¢×•×œ××™
        </h1>
        <p class="text-sm text-gray-300">×’×œ×’×œ ×¢×›×‘×¨ = ×–×•× | ×’×¨×™×¨×” = ×”×–×–×” | ×œ×—×™×¦×” ×¢×œ ××“×™× ×” ×œ×‘×—×™×¨×”</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-4 h-[calc(100vh-140px)]">
        
        <!-- ×¤×× ×œ × ×™×”×•×œ (×©×××œ) -->
        <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 overflow-y-auto border border-white/10">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i data-lucide="flag" class="w-5 h-5"></i>
                ×‘×§×¨×ª ××©×—×§
            </h2>

            <div class="bg-slate-700/50 rounded-lg p-3 mb-4">
                <h3 class="font-semibold mb-2 text-sm">×‘×—×™×¨×ª ×™×¢×“</h3>
                <div class="space-y-2 text-xs">
                    <div id="attacker-display" class="p-2 rounded bg-slate-600 transition-colors">×ª×•×§×£: ×œ× × ×‘×—×¨</div>
                    <div id="target-display" class="p-2 rounded bg-slate-600 transition-colors">××˜×¨×”: ×œ× × ×‘×—×¨</div>
                </div>
                <button id="war-btn" onclick="declareWar()" class="w-full mt-3 bg-red-600 hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed p-2 rounded font-semibold flex items-center justify-center gap-2 transition-all">
                    <i data-lucide="swords" class="w-4 h-4"></i>
                    ×”×›×¨×– ××œ×—××”!
                </button>
            </div>

            <div class="bg-slate-700/50 rounded-lg p-3 mb-4">
                <h3 class="font-semibold mb-2 text-sm">××”×™×¨×•×ª ×•×”×’×“×¨×•×ª</h3>
                <div class="flex gap-2 mb-2">
                    <button onclick="setSpeed(0.5)" class="speed-btn flex-1 p-1 bg-slate-600 rounded text-xs" data-speed="0.5">0.5x</button>
                    <button onclick="setSpeed(1)" class="speed-btn flex-1 p-1 bg-blue-600 rounded text-xs" data-speed="1">1x</button>
                    <button onclick="setSpeed(2)" class="speed-btn flex-1 p-1 bg-slate-600 rounded text-xs" data-speed="2">2x</button>
                </div>
                <div class="flex gap-2">
                    <button id="pause-btn" onclick="togglePause()" class="flex-1 bg-yellow-600 hover:bg-yellow-700 p-2 rounded flex items-center justify-center gap-2 text-xs">
                        <i data-lucide="pause" id="pause-icon" class="w-4 h-4"></i>
                        <span id="pause-text">×”×©×”×”</span>
                    </button>
                    <button onclick="resetGame()" class="flex-1 bg-purple-600 hover:bg-purple-700 p-2 rounded flex items-center justify-center gap-2 text-xs">
                        <i data-lucide="rotate-ccw" class="w-4 h-4"></i>
                        ××™×¤×•×¡
                    </button>
                </div>
            </div>

            <!-- ××œ×—××•×ª ×¤×¢×™×œ×•×ª -->
            <div id="active-wars-container" class="hidden bg-slate-700/50 rounded-lg p-3 mb-4">
                <h3 class="font-semibold mb-2 text-sm flex items-center gap-2 text-red-400">
                    <i data-lucide="swords" class="w-4 h-4"></i>
                    ××œ×—××•×ª ×¤×¢×™×œ×•×ª
                </h3>
                <div id="wars-list" class="space-y-3"></div>
            </div>

            <div class="bg-slate-700/50 rounded-lg p-3">
                <h3 class="font-semibold mb-2 text-sm">ğŸ“œ ×™×•××Ÿ ××™×¨×•×¢×™×</h3>
                <div id="event-log" class="space-y-1 text-[10px] max-h-40 overflow-y-auto"></div>
            </div>
        </div>

        <!-- ××¤×” ××¨×›×–×™×ª (×××¦×¢) -->
        <div class="lg:col-span-2 bg-slate-800/30 backdrop-blur rounded-xl p-2 relative overflow-hidden border border-white/5">
            <div class="absolute bottom-4 left-4 flex gap-2 z-10">
                <button onclick="adjustZoom(1.2)" class="bg-blue-600 hover:bg-blue-700 p-2 rounded-lg"><i data-lucide="zoom-in" class="w-5 h-5"></i></button>
                <button onclick="adjustZoom(0.8)" class="bg-blue-600 hover:bg-blue-700 p-2 rounded-lg"><i data-lucide="zoom-out" class="w-5 h-5"></i></button>
                <div id="zoom-display" class="bg-black/50 backdrop-blur px-3 py-2 rounded-lg text-xs flex items-center">×–×•×: 1.0x</div>
            </div>

            <div id="map-viewport" class="w-full h-full overflow-hidden map-container">
                <svg id="world-svg" width="900" height="600" viewBox="0 0 900 600" class="w-full h-full transition-transform duration-100 ease-out origin-center">
                    <rect width="900" height="600" fill="#0a192f" />
                    <g id="war-lines-group"></g>
                    <g id="countries-group"></g>
                </svg>
            </div>
        </div>

        <!-- ×“×™×¨×•×’ (×™××™×Ÿ) -->
        <div class="bg-slate-800/50 backdrop-blur rounded-xl p-4 overflow-y-auto border border-white/10">
            <h2 class="text-xl font-bold mb-4 flex items-center gap-2">
                <i data-lucide="users" class="w-5 h-5"></i>
                ×“×™×¨×•×’ ×¢×•×œ××™
            </h2>
            <div id="leaderboard" class="space-y-2"></div>
        </div>
    </div>

    <script>
        // --- × ×ª×•× ×™× ×•×§×‘×•×¢×™× ---
        const INITIAL_COUNTRIES = {
            '××¨×”"×‘': { strength: 100, territory: 100, color: '#3498db', path: 'M150,200 L120,180 L110,190 L100,200 L95,220 L100,250 L110,270 L130,280 L160,285 L190,280 L210,270 L230,250 L240,230 L245,210 L240,190 L220,180 L190,185 L170,190 Z' },
            '×§× ×“×”': { strength: 55, territory: 85, color: '#7d3c98', path: 'M100,80 L95,100 L100,120 L110,140 L130,155 L160,165 L190,170 L220,165 L240,155 L255,140 L265,120 L268,100 L265,85 L250,75 L220,70 L180,72 L140,75 Z' },
            '××§×¡×™×§×•': { strength: 35, territory: 45, color: '#138d75', path: 'M120,290 L110,295 L105,305 L108,320 L115,335 L130,345 L150,348 L170,345 L185,335 L190,320 L188,305 L180,295 L160,292 Z' },
            '×‘×¨×–×™×œ': { strength: 60, territory: 75, color: '#27ae60', path: 'M240,360 L230,370 L225,385 L228,405 L240,425 L260,440 L285,450 L310,448 L325,435 L332,415 L330,390 L320,370 L300,362 L275,360 Z' },
            '××¨×’× ×˜×™× ×”': { strength: 35, territory: 50, color: '#5dade2', path: 'M250,460 L245,475 L248,495 L258,515 L275,525 L292,523 L305,510 L308,490 L302,472 L288,463 Z' },
            '×‘×¨×™×˜× ×™×”': { strength: 65, territory: 30, color: '#e67e22', path: 'M430,135 L425,140 L423,148 L426,158 L433,165 L443,167 L452,164 L458,156 L458,145 L453,138 L445,135 Z' },
            '×¦×¨×¤×ª': { strength: 65, territory: 35, color: '#1abc9c', path: 'M435,175 L430,182 L432,195 L440,208 L455,215 L472,214 L485,207 L488,195 L485,183 L475,176 L458,174 Z' },
            '×’×¨×× ×™×”': { strength: 70, territory: 35, color: '#34495e', path: 'M468,160 L463,168 L465,178 L473,188 L487,192 L502,190 L510,182 L510,170 L505,162 L492,159 Z' },
            '×¡×¤×¨×“': { strength: 50, territory: 32, color: '#e74c3c', path: 'M420,200 L415,210 L418,225 L430,238 L448,242 L468,240 L482,230 L485,218 L480,208 L465,203 Z' },
            '×™×©×¨××œ': { strength: 60, territory: 18, color: '#3498db', path: 'M520,265 L518,270 L520,278 L526,283 L532,281 L535,274 L533,268 Z' },
            '×¨×•×¡×™×”': { strength: 90, territory: 120, color: '#9b59b6', path: 'M540,75 L530,90 L535,110 L545,130 L560,145 L580,155 L610,165 L650,170 L690,168 L720,160 L740,145 L750,125 L748,100 L740,82 L720,70 L680,65 L630,68 L580,72 Z' },
            '×¡×™×Ÿ': { strength: 95, territory: 100, color: '#e74c3c', path: 'M650,190 L645,210 L650,235 L665,260 L685,280 L715,295 L745,300 L770,290 L785,270 L790,245 L788,220 L780,200 L760,190 L730,188 L700,192 Z' },
            '×”×•×“×•': { strength: 80, territory: 75, color: '#f39c12', path: 'M620,285 L615,300 L618,320 L630,345 L650,365 L675,370 L695,360 L705,340 L705,315 L695,295 L675,288 Z' },
            '××•×¡×˜×¨×œ×™×”': { strength: 50, territory: 70, color: '#117864', path: 'M730,410 L725,430 L730,455 L750,478 L780,492 L815,495 L845,485 L860,465 L862,440 L855,420 L835,412 Z' }
        };

        let countries = JSON.parse(JSON.stringify(INITIAL_COUNTRIES));
        let selectedCountry = null;
        let targetCountry = null;
        let activeWars = [];
        let gameSpeed = 1;
        let isPaused = false;
        let zoom = 1;
        let pan = { x: 0, y: 0 };
        let isPanning = false;
        let startPan = { x: 0, y: 0 };

        // --- ××ª×—×•×œ ---
        window.onload = () => {
            lucide.createIcons();
            renderMap();
            updateLeaderboard();
            addLog("ğŸ® ×”××©×—×§ ××•×›×Ÿ. ×‘×—×¨ ××“×™× ×” ×›×“×™ ×œ×”×ª×—×™×œ!");
            
            // ×œ×•×œ××ª ××©×—×§
            setInterval(gameLoop, 1000);
        };

        // --- × ×™×”×•×œ ××¤×” ×•×œ×—×™×¦×•×ª ---
        function renderMap() {
            const group = document.getElementById('countries-group');
            group.innerHTML = '';
            
            Object.entries(countries).forEach(([name, data]) => {
                const center = getCountryCenter(data.path);
                const isSelected = name === selectedCountry;
                const isTarget = name === targetCountry;
                const isInWar = activeWars.some(w => w.attacker === name || w.defender === name);
                
                const g = document.createElementNS("http://www.w3.org/2000/svg", "g");
                g.setAttribute('class', 'country-group');
                g.onclick = () => selectCountry(name);

                const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
                path.setAttribute('d', data.path);
                path.setAttribute('fill', data.color);
                path.setAttribute('stroke', isSelected ? '#fbbf24' : (isTarget ? '#ef4444' : (isInWar ? '#f59e0b' : 'white')));
                path.setAttribute('stroke-width', isSelected || isTarget ? '4' : '2');
                path.setAttribute('opacity', data.territory <= 5 ? '0.2' : '0.7');
                path.setAttribute('class', 'country-path');
                
                const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
                text.setAttribute('x', center.x);
                text.setAttribute('y', center.y);
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', 'white');
                text.setAttribute('font-size', '10');
                text.setAttribute('style', 'pointer-events: none; text-shadow: 1px 1px 2px black;');
                text.textContent = `${name}`;

                const stats = document.createElementNS("http://www.w3.org/2000/svg", "text");
                stats.setAttribute('x', center.x);
                stats.setAttribute('y', center.y + 12);
                stats.setAttribute('text-anchor', 'middle');
                stats.setAttribute('fill', '#cbd5e1');
                stats.setAttribute('font-size', '8');
                stats.setAttribute('style', 'pointer-events: none;');
                stats.textContent = `ğŸ’ª${data.strength}`;

                g.appendChild(path);
                g.appendChild(text);
                g.appendChild(stats);
                group.appendChild(g);
            });
            renderWarLines();
        }

        function renderWarLines() {
            const group = document.getElementById('war-lines-group');
            group.innerHTML = '';
            activeWars.forEach(war => {
                const c1 = getCountryCenter(countries[war.attacker].path);
                const c2 = getCountryCenter(countries[war.defender].path);
                const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
                line.setAttribute('x1', c1.x); line.setAttribute('y1', c1.y);
                line.setAttribute('x2', c2.x); line.setAttribute('y2', c2.y);
                line.setAttribute('stroke', '#ef4444');
                line.setAttribute('stroke-width', '2');
                line.setAttribute('class', 'war-line');
                group.appendChild(line);
            });
        }

        // --- ×œ×•×’×™×§×ª ××©×—×§ ---
        function selectCountry(name) {
            if (!selectedCountry || (selectedCountry && targetCountry)) {
                selectedCountry = name;
                targetCountry = null;
                addLog(`âœ… × ×‘×—×¨×” ××“×™× ×” ×ª×•×§×¤×ª: ${name}`);
            } else if (selectedCountry === name) {
                selectedCountry = null;
            } else {
                targetCountry = name;
                addLog(`ğŸ¯ × ×‘×—×¨ ×™×¢×“ ×œ×›×™×‘×•×©: ${name}`);
            }
            updateSelectionUI();
            renderMap();
        }

        function updateSelectionUI() {
            const atkDisp = document.getElementById('attacker-display');
            const tgtDisp = document.getElementById('target-display');
            atkDisp.textContent = `×ª×•×§×£: ${selectedCountry || '×œ× × ×‘×—×¨'}`;
            atkDisp.className = `p-2 rounded ${selectedCountry ? 'bg-blue-600' : 'bg-slate-600'}`;
            tgtDisp.textContent = `××˜×¨×”: ${targetCountry || '×œ× × ×‘×—×¨'}`;
            tgtDisp.className = `p-2 rounded ${targetCountry ? 'bg-red-600' : 'bg-slate-600'}`;
        }

        function declareWar() {
            if (!selectedCountry || !targetCountry) return;
            const exists = activeWars.find(w => 
                (w.attacker === selectedCountry && w.defender === targetCountry) ||
                (w.attacker === targetCountry && w.defender === selectedCountry)
            );
            if (exists) {
                addLog("âš ï¸ ×›×‘×¨ ×§×™×™××ª ××œ×—××” ×‘×™×Ÿ ×”××“×™× ×•×ª!");
                return;
            }

            activeWars.push({
                id: Date.now(),
                attacker: selectedCountry,
                defender: targetCountry,
                progress: 50
            });
            addLog(`âš”ï¸ ××œ×—××” ×¤×¨×¦×”! ${selectedCountry} ×ª×•×§×¤×ª ××ª ${targetCountry}`);
            document.getElementById('active-wars-container').classList.remove('hidden');
            renderMap();
            updateWarsUI();
        }

        function gameLoop() {
            if (isPaused) return;

            activeWars = activeWars.filter(war => {
                const atk = countries[war.attacker];
                const def = countries[war.defender];
                
                // ×—×™×©×•×‘ ×™×—×¡×™ ×›×•×—×•×ª
                const ratio = atk.strength / def.strength;
                const change = (ratio - 1) * 2 * gameSpeed;
                war.progress += change + (Math.random() * 2 - 1);

                if (war.progress >= 100) {
                    const gain = Math.floor(def.territory * 0.3);
                    atk.territory += gain;
                    atk.strength += 5;
                    def.territory -= gain;
                    def.strength = Math.max(10, def.strength - 10);
                    addLog(`ğŸ† × ×™×¦×—×•×Ÿ! ${war.attacker} ×›×‘×©×” ×©×˜×—×™× ×-${war.defender}`);
                    return false;
                } else if (war.progress <= 0) {
                    addLog(`ğŸ›¡ï¸ ×”×“×™×¤×”! ${war.defender} ×”×¦×œ×™×—×” ×œ×‘×œ×•× ××ª ${war.attacker}`);
                    return false;
                }
                return true;
            });

            if (activeWars.length === 0) {
                document.getElementById('active-wars-container').classList.add('hidden');
            }

            renderMap();
            updateWarsUI();
            updateLeaderboard();
        }

        function updateWarsUI() {
            const list = document.getElementById('wars-list');
            list.innerHTML = '';
            activeWars.forEach(war => {
                const div = document.createElement('div');
                div.className = "bg-slate-800 rounded p-2 text-xs border border-white/5";
                div.innerHTML = `
                    <div class="flex justify-between mb-1">
                        <span>${war.attacker}</span>
                        <span>âš”ï¸</span>
                        <span>${war.defender}</span>
                    </div>
                    <div class="w-full bg-slate-700 h-2 rounded-full overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-500 to-red-500 h-full transition-all" style="width: ${war.progress}%"></div>
                    </div>
                    <div class="flex gap-1 mt-2">
                        <button onclick="boostWar('${war.id}', 5)" class="flex-1 bg-red-900 hover:bg-red-800 rounded py-1">×”×ª×§×£</button>
                        <button onclick="boostWar('${war.id}', -5)" class="flex-1 bg-blue-900 hover:bg-blue-800 rounded py-1">×”×’×Ÿ</button>
                    </div>
                `;
                list.appendChild(div);
            });
        }

        function boostWar(id, amt) {
            const war = activeWars.find(w => w.id == id);
            if (war) {
                war.progress = Math.min(100, Math.max(0, war.progress + amt));
                updateWarsUI();
            }
        }

        // --- ×¢×–×¨×™× ×•×××©×§ ---
        function updateLeaderboard() {
            const board = document.getElementById('leaderboard');
            const sorted = Object.entries(countries).sort((a, b) => b[1].territory - a[1].territory);
            board.innerHTML = '';
            sorted.forEach(([name, data], i) => {
                const div = document.createElement('div');
                div.className = `p-2 rounded-lg text-xs flex justify-between items-center ${i === 0 ? 'bg-yellow-600/40 border border-yellow-500' : 'bg-slate-700/30'}`;
                div.innerHTML = `
                    <div class="flex items-center gap-2">
                        <span class="font-bold w-4">${i+1}.</span>
                        <span>${name}</span>
                    </div>
                    <div class="flex gap-3">
                        <span>ğŸ’ª ${data.strength}</span>
                        <span class="font-bold">ğŸ›ï¸ ${data.territory}</span>
                    </div>
                `;
                board.appendChild(div);
            });
        }

        function addLog(msg) {
            const log = document.getElementById('event-log');
            const entry = document.createElement('div');
            entry.className = "p-1 border-b border-white/5 last:border-0";
            entry.textContent = `> ${msg}`;
            log.prepend(entry);
        }

        function getCountryCenter(path) {
            const coords = path.match(/[\d.]+/g).map(Number);
            let xSum = 0, ySum = 0, count = 0;
            for (let i = 0; i < coords.length; i += 2) {
                xSum += coords[i]; ySum += coords[i+1]; count++;
            }
            return { x: xSum / count, y: ySum / count };
        }

        function adjustZoom(factor) {
            zoom = Math.max(0.5, Math.min(5, zoom * factor));
            updateMapTransform();
        }

        function setSpeed(s) {
            gameSpeed = s;
            document.querySelectorAll('.speed-btn').forEach(b => {
                b.classList.remove('bg-blue-600');
                b.classList.add('bg-slate-600');
                if (parseFloat(b.dataset.speed) === s) b.classList.replace('bg-slate-600', 'bg-blue-600');
            });
        }

        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('pause-text').textContent = isPaused ? '×”××©×š' : '×”×©×”×”';
            document.getElementById('pause-icon').setAttribute('data-lucide', isPaused ? 'play' : 'pause');
            lucide.createIcons();
        }

        function resetGame() {
            countries = JSON.parse(JSON.stringify(INITIAL_COUNTRIES));
            activeWars = [];
            selectedCountry = null;
            targetCountry = null;
            addLog("ğŸ”„ ×”××©×—×§ ××•×¤×¡ ×œ××¦×‘ ×”×ª×—×œ×ª×™.");
            renderMap();
            updateLeaderboard();
            updateSelectionUI();
        }

        // --- ×©×œ×™×˜×” ×‘×ª× ×•×¢×ª ××¤×” (Pan & Zoom) ---
        const viewport = document.getElementById('map-viewport');
        const svg = document.getElementById('world-svg');

        viewport.addEventListener('mousedown', e => {
            isPanning = true;
            startPan = { x: e.clientX - pan.x, y: e.clientY - pan.y };
        });

        window.addEventListener('mousemove', e => {
            if (!isPanning) return;
            pan.x = e.clientX - startPan.x;
            pan.y = e.clientY - startPan.y;
            updateMapTransform();
        });

        window.addEventListener('mouseup', () => isPanning = false);

        viewport.addEventListener('wheel', e => {
            e.preventDefault();
            const delta = e.deltaY > 0 ? 0.9 : 1.1;
            zoom = Math.max(0.5, Math.min(5, zoom * delta));
            updateMapTransform();
        }, { passive: false });

        function updateMapTransform() {
            svg.style.transform = `translate(${pan.x}px, ${pan.y}px) scale(${zoom})`;
            document.getElementById('zoom-display').textContent = `×–×•×: ${zoom.toFixed(1)}x`;
        }
    </script>
</body>
</html>
